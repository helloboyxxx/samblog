<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>445_Blending | Yue's Notes</title>
<meta name=keywords content="Computational Photography"><meta name=description content="Pasting Images
Method 1 — Cut and paste the images.


Feathering

Gives a smoother transition. But that&rsquo;s all&mldr;



Alpha composting

Output = foreground $\times$ mask + background $\times$ (1 $-$ mask). We can also use alpha compositing together with the feathering — simply bluring the mask will give us a good feathering. This method is also good for multilayer processing, which allwos the compositing to be more complicated.



Method 2 — Pyramid Blending

At low frequencies, blend slowly
At high frequencies, blend quickly


  
    
		
     Burt and Adelson 1983 
  

Implementation:

Build Laplacian pyramids for each image
Build a Gaussian pyramid of region mask
Blend each level of pyramid using region mask from the same level

$$
L_{12}^i=L_1^i \cdot R^i+L_2^i \cdot\left(1-R^i\right)
$$"><meta name=author content><link rel=canonical href=https://ofuro.me/posts/445_blending-warping/><link crossorigin=anonymous href=/assets/css/stylesheet.3f9c3df41d49c1df83c4f93106bd40eae5ce265f122a1a1a99f034136f7c15f5.css integrity="sha256-P5w99B1Jwd+DxPkxBr1A6uXOJl8SKhoamfA0E298FfU=" rel="preload stylesheet" as=style><link rel=icon href=https://ofuro.me/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://ofuro.me/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://ofuro.me/favicon-32x32.png><link rel=apple-touch-icon href=https://ofuro.me/apple-touch-icon.png><link rel=mask-icon href=https://ofuro.me/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://ofuro.me/posts/445_blending-warping/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script><script id=MathJax-script async src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script><script>window.MathJax={tex:{inlineMath:[["$","$"],["\\(","\\)"]],displayMath:[["$$","$$"],["\\[","\\]"]],processEscapes:!0,processEnvironments:!0},options:{skipHtmlTags:["script","noscript","style","textarea","pre"]}},window.onload=function(){MathJax.typesetPromise().then(()=>{console.log("MathJax rendering complete.")})}</script><script src=//yihui.org/js/math-code.js defer></script><meta property="og:url" content="https://ofuro.me/posts/445_blending-warping/"><meta property="og:site_name" content="Yue's Notes"><meta property="og:title" content="445_Blending"><meta property="og:description" content="Pasting Images Method 1 — Cut and paste the images. Feathering
Gives a smoother transition. But that’s all… Alpha composting
Output = foreground $\times$ mask + background $\times$ (1 $-$ mask). We can also use alpha compositing together with the feathering — simply bluring the mask will give us a good feathering. This method is also good for multilayer processing, which allwos the compositing to be more complicated. Method 2 — Pyramid Blending At low frequencies, blend slowly At high frequencies, blend quickly Burt and Adelson 1983 Implementation: Build Laplacian pyramids for each image Build a Gaussian pyramid of region mask Blend each level of pyramid using region mask from the same level $$ L_{12}^i=L_1^i \cdot R^i+L_2^i \cdot\left(1-R^i\right) $$"><meta property="og:locale" content="en-us"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2023-10-30T10:34:53-05:00"><meta property="article:modified_time" content="2023-10-30T10:34:53-05:00"><meta property="article:tag" content="Computational Photography"><meta name=twitter:card content="summary"><meta name=twitter:title content="445_Blending"><meta name=twitter:description content="Pasting Images
Method 1 — Cut and paste the images.


Feathering

Gives a smoother transition. But that&rsquo;s all&mldr;



Alpha composting

Output = foreground $\times$ mask + background $\times$ (1 $-$ mask). We can also use alpha compositing together with the feathering — simply bluring the mask will give us a good feathering. This method is also good for multilayer processing, which allwos the compositing to be more complicated.



Method 2 — Pyramid Blending

At low frequencies, blend slowly
At high frequencies, blend quickly


  
    
		
     Burt and Adelson 1983 
  

Implementation:

Build Laplacian pyramids for each image
Build a Gaussian pyramid of region mask
Blend each level of pyramid using region mask from the same level

$$
L_{12}^i=L_1^i \cdot R^i+L_2^i \cdot\left(1-R^i\right)
$$"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://ofuro.me/posts/"},{"@type":"ListItem","position":2,"name":"445_Blending","item":"https://ofuro.me/posts/445_blending-warping/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"445_Blending","name":"445_Blending","description":"Pasting Images Method 1 — Cut and paste the images. Feathering\nGives a smoother transition. But that\u0026rsquo;s all\u0026hellip; Alpha composting\nOutput = foreground $\\times$ mask + background $\\times$ (1 $-$ mask). We can also use alpha compositing together with the feathering — simply bluring the mask will give us a good feathering. This method is also good for multilayer processing, which allwos the compositing to be more complicated. Method 2 — Pyramid Blending At low frequencies, blend slowly At high frequencies, blend quickly Burt and Adelson 1983 Implementation: Build Laplacian pyramids for each image Build a Gaussian pyramid of region mask Blend each level of pyramid using region mask from the same level $$ L_{12}^i=L_1^i \\cdot R^i+L_2^i \\cdot\\left(1-R^i\\right) $$\n","keywords":["Computational Photography"],"articleBody":"Pasting Images Method 1 — Cut and paste the images. Feathering\nGives a smoother transition. But that’s all… Alpha composting\nOutput = foreground $\\times$ mask + background $\\times$ (1 $-$ mask). We can also use alpha compositing together with the feathering — simply bluring the mask will give us a good feathering. This method is also good for multilayer processing, which allwos the compositing to be more complicated. Method 2 — Pyramid Blending At low frequencies, blend slowly At high frequencies, blend quickly Burt and Adelson 1983 Implementation: Build Laplacian pyramids for each image Build a Gaussian pyramid of region mask Blend each level of pyramid using region mask from the same level $$ L_{12}^i=L_1^i \\cdot R^i+L_2^i \\cdot\\left(1-R^i\\right) $$\nCollapse the pyramid to get the final blended image Method 3: Poisson Blending A good blend should preserve gradient of source region withough changing the background\nTreat pixels as variables to be solved\nMinimize squared difference between gradients of foreground region and gradients of target region Keep background pixels constant $$ \\mathbf{v}=\\underset{\\mathbf{v}}{\\operatorname{argmin}} \\sum_{i \\in S, j \\in N_i \\cap S}\\left(\\left(v_i-v_j\\right)-\\left(s_i-s_j\\right)\\right)^2+\\sum_{i \\in S, j \\in N_i \\cap \\neg S}\\left(\\left(v_i-t_j\\right)-\\left(s_i-s_j\\right)\\right)^2 $$\nWe want to put source image on the background image. The result is called “target image”. So, inside the pasted regeion, we want to make the gradient similar to the source image. But in the edge of our pasted regeion, we also want to make the transformation smaller. We can then use a least square method to solve for a vector $\\vec v$ to minimize the error.\nIn this example here, we have:\n$v_3 - v_1 \\approx s_{10} - s_{6} $\n$v_1 - t_2 \\approx s_6 - s_2$\nNote that this method doesn’t care color, so putting a bear in a pool of water will make the bear turn green.\nMethod 4: Blending with Mixed Gradients Use fourground or background gradient with larger magnitude as the guiding gradient. Since the larger gradient is always percieved, it is more likely to have the result of “writing something on the wall” instead of “sticking an printed image on the wall”.\nReference CS445 Derek Hoiem: https://courses.engr.illinois.edu/cs445/fa2023/\n","wordCount":"351","inLanguage":"en","datePublished":"2023-10-30T10:34:53-05:00","dateModified":"2023-10-30T10:34:53-05:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://ofuro.me/posts/445_blending-warping/"},"publisher":{"@type":"Organization","name":"Yue's Notes","logo":{"@type":"ImageObject","url":"https://ofuro.me/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://ofuro.me/ accesskey=h title="Yue's Notes (Alt + H)">Yue's Notes</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://ofuro.me/ title=Notes><span>Notes</span></a></li><li><a href=https://ofuro.me/about title="About Me"><span>About Me</span></a></li><li><a href=https://ofuro.me/archives title=Archive><span>Archive</span></a></li><li><a href=https://ofuro.me/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li><li><a href=https://ofuro.me/tags/ title=Tags><span>Tags</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class="post-title entry-hint-parent">445_Blending</h1><div class=post-meta><span title='2023-10-30 10:34:53 -0500 -0500'>October 30, 2023</span></div></header><div class=post-content><h3 id=pasting-images>Pasting Images<a hidden class=anchor aria-hidden=true href=#pasting-images>#</a></h3><h4 id=method-1--cut-and-paste-the-images>Method 1 — Cut and paste the images.<a hidden class=anchor aria-hidden=true href=#method-1--cut-and-paste-the-images>#</a></h4><ul><li><p>Feathering</p><ul><li>Gives a smoother transition. But that&rsquo;s all&mldr;</li></ul></li><li><p>Alpha composting</p><ul><li>Output = foreground $\times$ mask + background $\times$ (1 $-$ mask). We can also use alpha compositing together with the feathering — simply bluring the mask will give us a good feathering. This method is also good for multilayer processing, which allwos the compositing to be more complicated.</li></ul></li></ul><h4 id=method-2--pyramid-blending>Method 2 — Pyramid Blending<a hidden class=anchor aria-hidden=true href=#method-2--pyramid-blending>#</a></h4><ul><li>At low frequencies, blend slowly</li><li>At high frequencies, blend quickly</li></ul><center><figure><img src=https://raw.githubusercontent.com/helloboyxxx/images-for-notes/master/uPic/image-20231014195402853.png style=width:25%>
<img src=https://raw.githubusercontent.com/helloboyxxx/images-for-notes/master/uPic/image-20231014195459497.png style=width:25%><figcaption>Burt and Adelson 1983</figcaption></figure></center><h4 id=implementation>Implementation:<a hidden class=anchor aria-hidden=true href=#implementation>#</a></h4><ol><li>Build Laplacian pyramids for each image</li><li>Build a Gaussian pyramid of region mask</li><li>Blend each level of pyramid using region mask from the same level</li></ol><p>$$
L_{12}^i=L_1^i \cdot R^i+L_2^i \cdot\left(1-R^i\right)
$$</p><ol start=4><li>Collapse the pyramid to get the final blended image</li></ol><h4 id=method-3-poisson-blending>Method 3: Poisson Blending<a hidden class=anchor aria-hidden=true href=#method-3-poisson-blending>#</a></h4><p>A good blend should preserve gradient of source region withough changing the background</p><p>Treat pixels as variables to be solved</p><ul><li>Minimize squared difference between gradients of foreground region and gradients of target region</li><li>Keep background pixels constant</li></ul><p>$$
\mathbf{v}=\underset{\mathbf{v}}{\operatorname{argmin}} \sum_{i \in S, j \in N_i \cap S}\left(\left(v_i-v_j\right)-\left(s_i-s_j\right)\right)^2+\sum_{i \in S, j \in N_i \cap \neg S}\left(\left(v_i-t_j\right)-\left(s_i-s_j\right)\right)^2
$$</p><center><figure><img src=https://raw.githubusercontent.com/helloboyxxx/images-for-notes/master/uPic/image-20231014202200003.png style=width:50%><figcaption></figcaption></figure></center><p>We want to put source image on the background image. The result is called &ldquo;target image&rdquo;. So, inside the pasted regeion, we want to make the gradient similar to the source image. But in the edge of our pasted regeion, we also want to make the transformation smaller. We can then use a least square method to solve for a vector $\vec v$ to minimize the error.</p><p>In this example here, we have:</p><p>$v_3 - v_1 \approx s_{10} - s_{6} $</p><p>$v_1 - t_2 \approx s_6 - s_2$</p><p>Note that this method doesn&rsquo;t care color, so putting a bear in a pool of water will make the bear turn green.</p><center><figure><img src=https://raw.githubusercontent.com/helloboyxxx/images-for-notes/master/uPic/image-20231014203516497.png style=width:50%><figcaption></figcaption></figure></center><h4 id=method-4-blending-with-mixed-gradients>Method 4: Blending with Mixed Gradients<a hidden class=anchor aria-hidden=true href=#method-4-blending-with-mixed-gradients>#</a></h4><p>Use fourground or background gradient with <strong>larger magnitude</strong> as the guiding gradient. Since the larger gradient is always percieved, it is more likely to have the result of &ldquo;writing something on the wall&rdquo; instead of &ldquo;sticking an printed image on the wall&rdquo;.</p><h3 id=reference>Reference<a hidden class=anchor aria-hidden=true href=#reference>#</a></h3><p>CS445 Derek Hoiem: <a href=https://courses.engr.illinois.edu/cs445/fa2023/>https://courses.engr.illinois.edu/cs445/fa2023/</a></p></div><footer class=post-footer><ul class=post-tags><li><a href=https://ofuro.me/tags/computational-photography/>Computational Photography</a></li></ul></footer></article></main><footer class=footer><span>&copy; 2025 <a href=https://ofuro.me/>Yue's Notes</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>